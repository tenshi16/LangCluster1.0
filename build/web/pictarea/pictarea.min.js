/*! Pictarea v1.0.1 | Â©2016 GestiXi | Licensed under the MIT license */
!function(f){f.fn.pictarea=function(a){return this.each(function(){var b=this,c=f(this),d=c.data("pictarea");if("IMG"!==this.tagName)console.error("pictarea - ERROR: The element must be an img.");else if(!d){var e=c[0].complete,g=f.extend({},f.fn.pictarea.defaults,"object"==typeof a&&a),h=function(){c.data("pictarea",d=new l(b,g));d.drawCanvas(g)};e?h.apply(c[0]):c.on("load",h).attr("src",c.attr("src"))}else if("string"==typeof a)d[a]()})};f.fn.pictarea.defaults={normal:{fillStyle:"rgba(255,255,255,.4)",
strokeStyle:"rgba(255,255,255,.8)",lineWidth:1},hover:{fillStyle:"rgba(255,255,255,.6)",strokeStyle:"#fff",lineWidth:2,shadowColor:"#fff",shadowBlur:10},active:{fillStyle:"rgba(255,255,255,.8)",strokeStyle:"#f00",lineWidth:2},disabled:{fillStyle:"rgba(0,0,0,.4)",strokeStyle:"transparent"},areaValueKey:"target",areaDisableKey:"disabled",maxSelections:1,rescaleOnResize:!1};var l=function(a,b){var c=this;c.options=b;c.img=a;var d=c.$img=f(a);c.src=d.attr("src");c.imgWidth=a.naturalWidth||a.width;c.imgHeight=
a.naturalHeight||a.height;var d=this.$img,e=d.attr("usemap");if(e){var g={position:"absolute",top:0,left:0,right:0,bottom:0},e=this.$map=f('map[name="'+e.substr(1)+'"]');this.$initialMap=e.clone();var h=f('<div class="pictarea"></div>').css({position:"relative"}),k=d.clone().attr({id:null,"class":"pictarea-img",usemap:null}).css(g),g=this.createCanvas().css(g);d.before(h).css("opacity",0).remove();h.append(k);h.append(g);h.append(d);this.drawCanvas();e.on("mouseover",function(a){c.mouseover(a)}).on("mouseout",
function(a){c.mouseout(a)}).on("click touchstart",function(a){c.select(a);a.preventDefault()});b.rescaleOnResize&&f(window).resize(function(a){c.scheduleRedraw()})}else console.error("pictarea - ERROR: The img element must have a usemap attribute.")};f.fn.pictarea.Constructor=l;l.prototype={constructor:l,hovered:null,selection:null,value:null,createCanvas:function(){var a=f('<canvas style="width:100%;height:100%;"></canvas>');this.canvas=a[0];return this.$canvas=a},drawCanvas:function(){var a=this.canvas;
a.width=a.offsetWidth;a.height=a.offsetHeight;a.getContext("2d").clearRect(0,0,a.offsetWidth,a.offsetHeight);this.drawZones()},drawZones:function(){var a=this,b=this.$map,c=this.$initialMap.find("area");b.find("area").each(function(b){a.drawZone(this,c[b])})},drawZone:function(a,b){var c=this.canvas.getContext("2d"),d=f(a),e=d.attr("shape").toLowerCase().substr(0,4);if(b){for(var g=f(b).attr("coords").split(","),h=this.imgWidth/this.canvas.offsetWidth,k=0;k<g.length;k++)g[k]=parseFloat(g[k])/h;d.attr("coords",
g.join(","))}d=d.attr("coords").split(",");for(k=0;k<d.length;k++)d[k]=parseFloat(d[k]);c.save();this.drawShape(e,d);this.styleShape(a);c.restore()},drawShape:function(a,b){var c=this.canvas.getContext("2d");c.beginPath();if("rect"===a)c.rect(b[0],b[1],b[2]-b[0],b[3]-b[1]);else if("poly"===a){c.moveTo(b[0],b[1]);for(var d=2;d<b.length;d+=2)c.lineTo(b[d],b[d+1])}else"circ"===a&&c.arc(b[0],b[1],b[2],0,2*Math.PI,!1);c.closePath()},styleShape:function(a){var b=this.canvas.getContext("2d"),c=this.options,
d=c.areaDisableKey,e=c.normal;d&&a.hasAttribute(d)?e=c.disabled:(a===this.hovered&&(e=f.extend({},e,c.hover)),this.selection&&-1<this.selection.indexOf(a)&&(e=f.extend({},e,c.active)));f.extend(b,e);b.fill();b.stroke()},mouseover:function(a){var b=a.target;b&&(a=f.Event("enterArea.pictarea",{originalEvent:a,area:b,pictarea:this}),this.$img.trigger(a),a.isDefaultPrevented()||(this.hovered=b,this.drawCanvas()))},mouseout:function(a){var b=a.target;b&&(a=f.Event("leaveArea.pictarea",{originalEvent:a,
area:b,pictarea:this}),this.$img.trigger(a),a.isDefaultPrevented()||(this.hovered=null,this.drawCanvas()))},select:function(a){var b=a.target,c=this.options,d=c.areaValueKey,e=this.selection,g=null,h=f.Event("selectArea.pictarea",{originalEvent:a,area:b,key:d?b.getAttribute(d):null,pictarea:this});this.$img.trigger(h);if(!h.isDefaultPrevented()){e||(e=[]);var h=e.indexOf(b),k=c.maxSelections;for(-1===h?e.push(b):e.splice(h,1);0<=k&&e.length>c.maxSelections;)e.shift();d&&(1===k?e[0]&&(g=e[0].getAttribute(d)):
1<k&&(g=[],e.forEach(function(a){(a=a.getAttribute(d))&&g.push(a)})));this.selection=e;this.value=g;this.drawCanvas();a=f.Event("change.pictarea",{originalEvent:a,area:b,selection:e,value:g,pictarea:this});this.$img.trigger(a)}},destroy:function(){this._isDestroyed=!0;this.$img.removeData("pictarea")},scheduleRedraw:function(){if(!this._didScheduleScale)if(window.requestAnimationFrame){var a=this;this._didScheduleScale=!0;requestAnimationFrame(function(){a.drawCanvas()})}else this.drawCanvas()}}}(window.jQuery);